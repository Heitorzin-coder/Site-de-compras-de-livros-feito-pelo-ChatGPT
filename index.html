<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Livraria Aurora ‚Äî Seu e-commerce de livros</title>
  
  <!--
    ==============================================
    PROJETO: Loja de Livros (E-commerce simples)
    TECNOLOGIAS: HTML + CSS + JavaScript (vanilla)
    OBJETIVO: Demonstrar um site de compras com cat√°logo, busca, filtro,
              carrinho, favoritos, checkout simulado e persist√™ncia local.

    Tudo est√° MUITO comentado em portugu√™s para voc√™ entender cada parte.
    Voc√™ pode abrir esse arquivo diretamente no navegador e j√° funciona.
    ==============================================
  -->

  <!-- Google Fonts para uma tipografia mais bonita (opcional) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ======================================================
       ESTILOS GERAIS (RESET + VARI√ÅVEIS + UTILIT√ÅRIOS)
       ====================================================== */
    :root {
      --bg: #0b1020;              /* Fundo geral (um azul bem escuro) */
      --card: #121a33;            /* Fundo dos cards */
      --muted: #94a3b8;           /* Texto secund√°rio */
      --text: #e5e7eb;            /* Texto principal (quase branco) */
      --brand: #7c3aed;           /* Roxo para destaques */
      --brand-2: #22d3ee;         /* Ciano para detalhes */
      --success: #10b981;         /* Verde para sucesso */
      --danger: #ef4444;          /* Vermelho para remover */
      --warning: #f59e0b;         /* Amarelo para avisos */
      --radius: 16px;             /* Raio padr√£o dos cantos */
      --shadow: 0 10px 25px rgba(0,0,0,.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(124,58,237,.15), transparent 60%),
                  radial-gradient(1200px 600px at 90% 20%, rgba(34,211,238,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.6;
    }

    a { color: inherit; text-decoration: none; }
    img { max-width: 100%; display: block; }
    button { font-family: inherit; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    /* ======================================================
       CABE√áALHO
       ====================================================== */
    header {
      position: sticky; /* Fica preso no topo ao rolar */
      top: 0;
      z-index: 10;
      backdrop-filter: blur(8px);
      background: rgba(11,16,32,.6);
      border-bottom: 1px solid rgba(124,58,237,.25);
    }

    .header-inner {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr; /* Logo | Busca | A√ß√µes */
      gap: 12px;
      align-items: center;
      padding: 12px 0;
    }

    .brand {
      display: flex; align-items: center; gap: 10px;
      font-weight: 800; letter-spacing: .3px; font-size: 1.15rem;
    }
    .brand .logo {
      width: 36px; height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: 0 6px 18px rgba(124,58,237,.35);
    }

    /* Barra de busca */
    .search {
      display: flex; gap: 8px;
      background: var(--card);
      padding: 8px; border-radius: var(--radius);
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.06);
    }
    .search input {
      flex: 1; border: none; outline: none;
      background: transparent; color: var(--text);
      font-size: .95rem;
    }
    .search button { border: none; padding: 10px 14px; border-radius: 10px; cursor: pointer; }
    .btn-primary { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: #0b1020; font-weight: 700; }

    /* Bot√µes do topo (Favoritos e Carrinho) */
    .top-actions { display: flex; justify-content: flex-end; gap: 10px; }
    .icon-btn {
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      padding: 10px 12px; border-radius: 12px; cursor: pointer;
      display: inline-flex; align-items: center; gap: 8px; box-shadow: var(--shadow);
    }
    .badge { background: var(--brand-2); color: #0b1020; padding: 2px 8px; border-radius: 999px; font-weight: 800; font-size: .8rem; }

    /* ======================================================
       LAYOUT PRINCIPAL (SIDEBAR + LISTA)
       ====================================================== */
    .layout { display: grid; grid-template-columns: 260px 1fr; gap: 18px; margin-top: 18px; }

    /* Sidebar de filtros */
    .sidebar {
      background: var(--card);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      padding: 16px; box-shadow: var(--shadow);
      height: fit-content;
      position: sticky; top: 88px; /* cola abaixo do header */
    }
    .sidebar h3 { margin: 0 0 12px 0; font-size: 1rem; letter-spacing: .4px; }
    .filter-group { margin-bottom: 16px; }
    .filter-group label { display: block; margin-bottom: 8px; color: var(--muted); font-size: .9rem; }
    .chip-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip {
      padding: 8px 12px; border-radius: 999px; cursor: pointer;
      background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08);
      font-size: .85rem; color: var(--text);
    }
    .chip.active { outline: 2px solid var(--brand-2); background: rgba(34,211,238,.12); }

    .range { width: 100%; }
    .muted { color: var(--muted); font-size: .9rem; }

    /* Lista de livros */
    .grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      overflow: hidden; box-shadow: var(--shadow);
      display: flex; flex-direction: column;
    }
    .cover {
      aspect-ratio: 16/10; /* Mant√©m propor√ß√£o agrad√°vel */
      background: rgba(255,255,255,.04);
      display: grid; place-items: center;
    }
    .card-body { padding: 12px; display: grid; gap: 6px; }
    .title { font-weight: 700; letter-spacing: .3px; }
    .author { color: var(--muted); font-size: .9rem; }
    .price { font-weight: 800; }
    .stars { font-size: .95rem; color: #fbbf24; }
    .actions { margin-top: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .btn { border: none; padding: 10px 12px; border-radius: 10px; cursor: pointer; }
    .btn-ghost { background: rgba(255,255,255,.06); color: var(--text); }
    .btn-danger { background: rgba(239,68,68,.12); color: #fecaca; border: 1px solid rgba(239,68,68,.35); }

    /* Barra superior da listagem (ordenar + status) */
    .listbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
    select, .select { background: var(--card); color: var(--text); border: 1px solid rgba(255,255,255,.1); border-radius: 10px; padding: 8px 10px; }

    /* ======================================================
       CARRINHO (PAINEL LATERAL)
       ====================================================== */
    .drawer {
      position: fixed; inset: 0; /* cobre a tela */
      display: none; /* aparece quando tiver a classe .open */
    }
    .drawer.open { display: grid; grid-template-columns: 1fr 380px; }
    .backdrop { background: rgba(0,0,0,.55); }
    .panel {
      background: #0e142a; border-left: 1px solid rgba(255,255,255,.1);
      padding: 16px; display: grid; grid-template-rows: auto 1fr auto; gap: 12px;
    }
    .panel h3 { margin: 0; }
    .cart-list { display: grid; gap: 10px; overflow: auto; max-height: calc(100vh - 220px); padding-right: 4px; }
    .cart-item { display: grid; grid-template-columns: 56px 1fr auto; gap: 10px; align-items: center; background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.06); border-radius: 12px; padding: 8px; }
    .qty {
      display: inline-grid; grid-template-columns: repeat(3, 32px); gap: 6px; align-items: center;
    }
    .qty button { border: 1px solid rgba(255,255,255,.1); background: var(--card); color: var(--text); border-radius: 10px; padding: 6px 0; cursor: pointer; }
    .summary { background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 12px; display: grid; gap: 6px; }
    .summary .row { display: flex; justify-content: space-between; }
    .checkout { display: grid; gap: 10px; }

    /* ======================================================
       RESPONSIVIDADE
       ====================================================== */
    @media (max-width: 980px) {
      .layout { grid-template-columns: 1fr; }
      .sidebar { position: static; order: 2; }
      .grid { grid-template-columns: repeat(2, 1fr); }
      .header-inner { grid-template-columns: 1fr; gap: 8px; }
      .top-actions { justify-content: flex-start; }
    }
    @media (max-width: 620px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- ============================== HEADER ============================== -->
  <header>
    <div class="container header-inner">
      <a href="#" class="brand" title="P√°gina inicial">
        <div class="logo" aria-hidden="true"></div>
        <span>Livraria <span style="color: var(--brand-2)">Aurora</span></span>
      </a>

      <!-- Barra de busca: filtra por t√≠tulo, autor ou categoria -->
      <form class="search" id="searchForm">
        <input id="searchInput" type="search" placeholder="Busque por t√≠tulo, autor ou categoria‚Ä¶" aria-label="Buscar livros" />
        <button class="btn-primary" type="submit">Buscar</button>
      </form>

      <!-- A√ß√µes do topo: Favoritos e Carrinho -->
      <div class="top-actions">
        <button class="icon-btn" id="btnFavs" title="Favoritos">
          ‚ù§Ô∏è Favoritos <span class="badge" id="favCount">0</span>
        </button>
        <button class="icon-btn" id="btnCart" title="Abrir carrinho">
          üõí Carrinho <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ============================== CONTE√öDO ============================== -->
  <main class="container">
    <div class="layout">
      <!-- --------- Sidebar de Filtros --------- -->
      <aside class="sidebar" aria-label="Filtros">
        <h3>Filtros</h3>

        <div class="filter-group">
          <label>Categorias</label>
          <div class="chip-row" id="categoryChips"><!-- gerado via JS --></div>
        </div>

        <div class="filter-group">
          <label>Faixa de Pre√ßo: <span id="priceLabel" class="muted"></span></label>
          <input type="range" min="20" max="300" step="10" value="300" class="range" id="priceRange" />
        </div>

        <div class="filter-group">
          <label>Disponibilidade</label>
          <div class="chip-row">
            <button class="chip active" data-stock="all">Todos</button>
            <button class="chip" data-stock="in">Em estoque</button>
            <button class="chip" data-stock="out">Indispon√≠vel</button>
          </div>
        </div>

        <div class="filter-group">
          <label>Limpar Filtros</label>
          <button id="clearFilters" class="btn btn-danger" type="button">Limpar</button>
        </div>
      </aside>

      <!-- --------- √Årea de Listagem --------- -->
      <section>
        <div class="listbar">
          <div class="muted" id="resultInfo">Carregando‚Ä¶</div>
          <div>
            <select id="sortSelect" aria-label="Ordenar">
              <option value="relevance">Ordenar: Relev√¢ncia</option>
              <option value="price-asc">Pre√ßo: menor ‚Üí maior</option>
              <option value="price-desc">Pre√ßo: maior ‚Üí menor</option>
              <option value="rating-desc">Avalia√ß√£o: maior ‚Üí menor</option>
              <option value="title-asc">T√≠tulo: A ‚Üí Z</option>
            </select>
          </div>
        </div>

        <div class="grid" id="bookGrid"><!-- cards dos livros via JS --></div>
      </section>
    </div>
  </main>

  <!-- ============================== DRAWER DO CARRINHO ============================== -->
  <div class="drawer" id="cartDrawer" aria-hidden="true" role="dialog" aria-label="Carrinho de compras">
    <div class="backdrop" id="drawerBackdrop"></div>
    <div class="panel">
      <div style="display:flex; align-items:center; justify-content:space-between">
        <h3>Seu carrinho</h3>
        <button class="btn btn-ghost" id="btnCloseCart">Fechar</button>
      </div>

      <div class="cart-list" id="cartList"><!-- itens do carrinho --></div>

      <div class="summary">
        <div class="row"><span>Subtotal</span><strong id="subtotal">R$¬†0,00</strong></div>
        <div class="row"><span>Frete</span><span class="muted">Gr√°tis</span></div>
        <div class="row" style="border-top:1px solid rgba(255,255,255,.08); padding-top:6px"><span>Total</span><strong id="total">R$¬†0,00</strong></div>
        <div class="checkout">
          <button id="btnCheckout" class="btn btn-primary">Finalizar compra</button>
          <small class="muted">Checkout simulado ‚Äî n√£o processa pagamento real.</small>
        </div>
      </div>
    </div>
  </div>

  <template id="tplCartItem">
    <div class="cart-item">
      <div class="thumb" style="width:56px; height:56px; border-radius:8px; background:rgba(255,255,255,.06);"></div>
      <div>
        <div class="title"></div>
        <div class="muted" style="font-size:.85rem"></div>
      </div>
      <div style="display:grid; gap:6px; justify-items:end">
        <div class="price"></div>
        <div class="qty">
          <button class="decrease">‚àí</button>
          <div class="count" style="text-align:center;">1</div>
          <button class="increase">+</button>
        </div>
        <button class="btn btn-danger remove">Remover</button>
      </div>
    </div>
  </template>

  <!-- ============================== SCRIPT ============================== -->
  <script>
    // ==============================================================
    // UTILIT√ÅRIOS E DADOS INICIAIS
    // ==============================================================

    // Formata n√∫meros para moeda BRL (R$)
    const money = (n) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(n);

    // Gera estrelas (emoji) a partir de um n√∫mero (0-5, com .5)
    function stars(rating) {
      const full = Math.floor(rating);
      const half = rating - full >= 0.5 ? 1 : 0;
      const empty = 5 - full - half;
      return '‚òÖ'.repeat(full) + (half ? '‚òÜ' : '') + '‚ú©'.repeat(empty);
    }

    // Banco de dados fict√≠cio de livros
    // Voc√™ pode expandir √† vontade! Ids √∫nicos, categorias variadas.
    const BOOKS = [
      { id: 'bk-01', title: 'Dom Casmurro', author: 'Machado de Assis', price: 39.9, rating: 4.8, stock: true, category: 'Cl√°ssicos', cover: 'üìò' },
      { id: 'bk-02', title: 'O Alquimista', author: 'Paulo Coelho', price: 49.9, rating: 4.2, stock: true, category: 'Fic√ß√£o', cover: 'üìó' },
      { id: 'bk-03', title: 'Quincas Borba', author: 'Machado de Assis', price: 34.9, rating: 4.1, stock: true, category: 'Cl√°ssicos', cover: 'üìò' },
      { id: 'bk-04', title: '1984', author: 'George Orwell', price: 59.9, rating: 4.9, stock: true, category: 'Fic√ß√£o', cover: 'üìô' },
      { id: 'bk-05', title: 'O Hobbit', author: 'J.R.R. Tolkien', price: 79.9, rating: 4.8, stock: true, category: 'Fantasia', cover: 'üìó' },
      { id: 'bk-06', title: 'Clean Code', author: 'Robert C. Martin', price: 199.9, rating: 4.7, stock: true, category: 'Tecnologia', cover: 'üíª' },
      { id: 'bk-07', title: 'Senhor dos An√©is', author: 'J.R.R. Tolkien', price: 149.9, rating: 4.9, stock: false, category: 'Fantasia', cover: 'üìó' },
      { id: 'bk-08', title: 'A Revolu√ß√£o dos Bichos', author: 'George Orwell', price: 39.9, rating: 4.6, stock: true, category: 'Fic√ß√£o', cover: 'üìô' },
      { id: 'bk-09', title: 'Harry Potter e a Pedra Filosofal', author: 'J.K. Rowling', price: 79.9, rating: 4.7, stock: true, category: 'Fantasia', cover: 'üìó' },
      { id: 'bk-10', title: 'Estruturas de Dados', author: 'N. Wirth', price: 129.9, rating: 4.3, stock: true, category: 'Tecnologia', cover: 'üíª' },
      { id: 'bk-11', title: 'Mem√≥rias P√≥stumas de Br√°s Cubas', author: 'Machado de Assis', price: 44.9, rating: 4.7, stock: true, category: 'Cl√°ssicos', cover: 'üìò' },
      { id: 'bk-12', title: 'Duna', author: 'Frank Herbert', price: 99.9, rating: 4.8, stock: true, category: 'Fic√ß√£o Cient√≠fica', cover: 'üöÄ' },
      { id: 'bk-13', title: 'Neuromancer', author: 'William Gibson', price: 89.9, rating: 4.4, stock: true, category: 'Fic√ß√£o Cient√≠fica', cover: 'üöÄ' },
      { id: 'bk-14', title: 'Design Patterns', author: 'Gamma et al.', price: 219.9, rating: 4.6, stock: true, category: 'Tecnologia', cover: 'üíª' },
      { id: 'bk-15', title: 'It: A Coisa', author: 'Stephen King', price: 79.9, rating: 4.5, stock: true, category: 'Terror', cover: 'vüëª' },
      { id: 'bk-16', title: 'O Capital vol. 1', author: 'Karl Marx', price: 42.6, rating: 4.8, stock: true, category: 'Obra de Refer√™ncia', cover: '‚≠ï' },
      { id: 'bk-17', title: 'O Capital vol. 2', author: 'Karl Marx', price: 93.7, rating: 4.9, stock: true, category: 'Obra de Refer√™ncia', cover: '‚≠ï' },
      { id: 'bk-18', title: 'O Capital vol. 3', author: 'Karl Marx', price: 106.7, rating: 4.9, stock: true, category: 'Obra de Refer√™ncia', cover: '‚≠ï' },
    ];

    // ==============================================================
    // ESTADO DA APLICA√á√ÉO (filtragem, carrinho, favoritos)
    // ==============================================================

    const state = {
      query: '',              // texto da busca
      category: 'Todas',      // categoria ativa
      maxPrice: 300,          // filtro por pre√ßo m√°ximo
      stock: 'all',           // all | in | out
      sort: 'relevance',      // estrat√©gia de ordena√ß√£o
      cart: load('cart', []), // itens do carrinho {id, qty}
      favs: load('favs', []), // ids favoritos
    };

    // Helpers de persist√™ncia no localStorage
    function save(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
    function load(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; }
      catch { return fallback; }
    }

    // Retorna o livro completo pelo id
    const byId = id => BOOKS.find(b => b.id === id);

    // ==============================================================
    // RENDERIZA√á√ÉO: CATEGORIAS E FILTROS
    // ==============================================================

    const els = {
      bookGrid: document.getElementById('bookGrid'),
      resultInfo: document.getElementById('resultInfo'),
      sortSelect: document.getElementById('sortSelect'),
      searchForm: document.getElementById('searchForm'),
      searchInput: document.getElementById('searchInput'),
      categoryChips: document.getElementById('categoryChips'),
      priceRange: document.getElementById('priceRange'),
      priceLabel: document.getElementById('priceLabel'),
      clearFilters: document.getElementById('clearFilters'),
      cartDrawer: document.getElementById('cartDrawer'),
      drawerBackdrop: document.getElementById('drawerBackdrop'),
      btnCart: document.getElementById('btnCart'),
      btnCloseCart: document.getElementById('btnCloseCart'),
      cartList: document.getElementById('cartList'),
      subtotal: document.getElementById('subtotal'),
      total: document.getElementById('total'),
      cartCount: document.getElementById('cartCount'),
      favCount: document.getElementById('favCount'),
      btnFavs: document.getElementById('btnFavs'),
    };

    // Gera as chips de categoria com base nas categorias existentes
    const categories = ['Todas', ...Array.from(new Set(BOOKS.map(b => b.category)))];

    function renderCategoryChips() {
      els.categoryChips.innerHTML = '';
      categories.forEach(cat => {
        const btn = document.createElement('button');
        btn.className = 'chip' + (state.category === cat ? ' active' : '');
        btn.textContent = cat;
        btn.addEventListener('click', () => {
          state.category = cat; render();
        });
        els.categoryChips.appendChild(btn);
      });
    }

    // Atualiza o r√≥tulo do range de pre√ßo
    function updatePriceLabel() {
      els.priceLabel.textContent = `at√© ${money(Number(els.priceRange.value))}`;
    }

    // ==============================================================
    // FILTRAGEM E ORDENA√á√ÉO
    // ==============================================================

    function applyFilters() {
      // 1) texto
      const q = state.query.toLowerCase();

      // 2) filtra por condi√ß√µes
      let list = BOOKS.filter(b => {
        const matchText = [b.title, b.author, b.category].some(v => v.toLowerCase().includes(q));
        const matchCat = state.category === 'Todas' || b.category === state.category;
        const matchPrice = b.price <= state.maxPrice;
        const matchStock = state.stock === 'all' || (state.stock === 'in' ? b.stock : !b.stock);
        return matchText && matchCat && matchPrice && matchStock;
      });

      // 3) ordena√ß√£o
      switch (state.sort) {
        case 'price-asc': list.sort((a,b)=> a.price - b.price); break;
        case 'price-desc': list.sort((a,b)=> b.price - a.price); break;
        case 'rating-desc': list.sort((a,b)=> b.rating - a.rating); break;
        case 'title-asc': list.sort((a,b)=> a.title.localeCompare(b.title, 'pt-BR')); break;
        default: /* relevance */
          // Relev√¢ncia simples: prioriza rating e em estoque
          list.sort((a,b)=> (b.stock - a.stock) || (b.rating - a.rating));
      }

      return list;
    }

    // ==============================================================
    // RENDERIZA√á√ÉO DOS CARDS
    // ==============================================================

    function renderBooks() {
      const list = applyFilters();
      els.bookGrid.innerHTML = '';

      // Info do resultado: quantos itens encontramos
      els.resultInfo.textContent = list.length ? `${list.length} livro(s) encontrado(s)` : 'Nenhum livro encontrado';

      list.forEach(b => {
        const card = document.createElement('article');
        card.className = 'card';

        // Capa (aqui usamos emojis ‚Äî troque por <img src="..."> se quiser)
        const cover = document.createElement('div');
        cover.className = 'cover';
        cover.innerHTML = `<div style="font-size:48px">${b.cover}</div>`;
        card.appendChild(cover);

        // Corpo do card
        const body = document.createElement('div');
        body.className = 'card-body';
        body.innerHTML = `
          <div class="title">${b.title}</div>
          <div class="author">${b.author} ‚Ä¢ <span class="muted">${b.category}</span></div>
          <div class="stars" title="Avalia√ß√£o m√©dia">${stars(b.rating)} <span class="muted">(${b.rating.toFixed(1)})</span></div>
          <div class="price">${money(b.price)}</div>
        `;

        // A√ß√µes (favoritar + adicionar)
        const actions = document.createElement('div');
        actions.className = 'actions';

        const favBtn = document.createElement('button');
        favBtn.className = 'btn btn-ghost';
        favBtn.textContent = state.favs.includes(b.id) ? '‚ù§Ô∏è Favorito' : 'ü§ç Favoritar';
        favBtn.addEventListener('click', () => {
          toggleFav(b.id);
          favBtn.textContent = state.favs.includes(b.id) ? '‚ù§Ô∏è Favorito' : 'ü§ç Favoritar';
        });

        const addBtn = document.createElement('button');
        addBtn.className = 'btn btn-primary';
        addBtn.textContent = b.stock ? 'üõí Adicionar' : 'Indispon√≠vel';
        addBtn.disabled = !b.stock;
        addBtn.addEventListener('click', () => addToCart(b.id));

        actions.appendChild(favBtn);
        actions.appendChild(addBtn);

        body.appendChild(actions);
        card.appendChild(body);
        els.bookGrid.appendChild(card);
      });
    }

    // ==============================================================
    // FAVORITOS
    // ==============================================================

    function toggleFav(id) {
      const i = state.favs.indexOf(id);
      if (i >= 0) state.favs.splice(i,1); else state.favs.push(id);
      save('favs', state.favs);
      updateBadges();
    }

    // Bot√£o de favoritos: filtra para mostrar apenas os favoritados
    els.btnFavs.addEventListener('click', () => {
      if (state.favs.length === 0) {
        alert('Voc√™ ainda n√£o favoritou nenhum livro. Use o bot√£o "Favoritar" nos cards.');
        return;
      }
      // Truque simples: aplica busca por ids favoritados (ou poderia usar um flag dedicado)
      const favSet = new Set(state.favs);
      const favList = BOOKS.filter(b => favSet.has(b.id));
      els.resultInfo.textContent = `${favList.length} favorito(s)`;
      els.bookGrid.innerHTML = '';
      favList.forEach(b => {
        // Reaproveita render b√°sico de card
        const card = document.createElement('article');
        card.className = 'card';
        const cover = document.createElement('div');
        cover.className = 'cover';
        cover.innerHTML = `<div style="font-size:48px">${b.cover}</div>`;
        const body = document.createElement('div');
        body.className = 'card-body';
        body.innerHTML = `
          <div class="title">${b.title}</div>
          <div class="author">${b.author} ‚Ä¢ <span class="muted">${b.category}</span></div>
          <div class="stars">${stars(b.rating)} <span class="muted">(${b.rating.toFixed(1)})</span></div>
          <div class="price">${money(b.price)}</div>
        `;
        const actions = document.createElement('div');
        actions.className = 'actions';
        const favBtn = document.createElement('button');
        favBtn.className = 'btn btn-ghost';
        favBtn.textContent = '‚ù§Ô∏è Favorito';
        favBtn.addEventListener('click', () => { toggleFav(b.id); render(); });
        const addBtn = document.createElement('button');
        addBtn.className = 'btn btn-primary';
        addBtn.textContent = b.stock ? 'üõí Adicionar' : 'Indispon√≠vel';
        addBtn.disabled = !b.stock;
        addBtn.addEventListener('click', () => addToCart(b.id));
        actions.appendChild(favBtn); actions.appendChild(addBtn);
        body.appendChild(actions);
        card.appendChild(cover); card.appendChild(body);
        els.bookGrid.appendChild(card);
      });
    });

    // ==============================================================
    // CARRINHO DE COMPRAS
    // ==============================================================

    function addToCart(id) {
      const item = state.cart.find(i => i.id === id);
      if (item) item.qty++;
      else state.cart.push({ id, qty: 1 });
      save('cart', state.cart);
      updateBadges();
      openCart();
      renderCart();
    }

    function changeQty(id, delta) {
      const item = state.cart.find(i => i.id === id);
      if (!item) return;
      item.qty += delta;
      if (item.qty <= 0) {
        state.cart = state.cart.filter(i => i.id !== id);
      }
      save('cart', state.cart);
      renderCart();
      updateBadges();
    }

    function removeFromCart(id) {
      state.cart = state.cart.filter(i => i.id !== id);
      save('cart', state.cart);
      renderCart();
      updateBadges();
    }

    function openCart() { els.cartDrawer.classList.add('open'); els.cartDrawer.setAttribute('aria-hidden','false'); }
    function closeCart() { els.cartDrawer.classList.remove('open'); els.cartDrawer.setAttribute('aria-hidden','true'); }

    els.btnCart.addEventListener('click', openCart);
    els.btnCloseCart.addEventListener('click', closeCart);
    els.drawerBackdrop.addEventListener('click', closeCart);

    function renderCart() {
      els.cartList.innerHTML = '';
      let subtotal = 0;

      const tpl = document.getElementById('tplCartItem');

      state.cart.forEach(({id, qty}) => {
        const b = byId(id);
        const node = tpl.content.cloneNode(true);
        node.querySelector('.thumb').textContent = b.cover;
        node.querySelector('.title').textContent = b.title;
        node.querySelector('.muted').textContent = b.author;
        node.querySelector('.price').textContent = money(b.price * qty);
        node.querySelector('.count').textContent = qty;

        node.querySelector('.increase').addEventListener('click', () => changeQty(id, +1));
        node.querySelector('.decrease').addEventListener('click', () => changeQty(id, -1));
        node.querySelector('.remove').addEventListener('click', () => removeFromCart(id));

        subtotal += b.price * qty;
        els.cartList.appendChild(node);
      });

      els.subtotal.textContent = money(subtotal);
      els.total.textContent = money(subtotal); // Frete gr√°tis no exemplo

      if (state.cart.length === 0) {
        els.cartList.innerHTML = '<div class="muted">Seu carrinho est√° vazio.</div>';
      }
    }

    function updateBadges() {
      const totalItems = state.cart.reduce((acc, i) => acc + i.qty, 0);
      els.cartCount.textContent = totalItems;
      els.favCount.textContent = state.favs.length;
    }

    // Checkout simulado
    document.getElementById('btnCheckout').addEventListener('click', () => {
      if (!state.cart.length) return alert('Seu carrinho est√° vazio!');
      const ref = Math.random().toString(36).slice(2,8).toUpperCase();
      alert(`Pedido confirmado!\n\nRefer√™ncia: #${ref}\nItens: ${state.cart.length}\nTotal: ${els.total.textContent}\n\n*Pagamento n√£o processado (simula√ß√£o).*`);
      state.cart = [];
      save('cart', state.cart);
      renderCart();
      updateBadges();
      closeCart();
    });

    // ==============================================================
    // EVENTOS DE BUSCA, FILTRO E ORDENA√á√ÉO
    // ==============================================================

    // Busca com debouncing (evita executar a cada tecla rapidamente)
    let debounceTimer;
    function debounce(fn, ms = 250) {
      clearTimeout(debounceTimer); debounceTimer = setTimeout(fn, ms);
    }

    els.searchInput.addEventListener('input', (e) => {
      debounce(() => { state.query = e.target.value.trim(); render(); }, 250);
    });

    els.searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      state.query = els.searchInput.value.trim();
      render();
    });

    els.priceRange.addEventListener('input', () => {
      state.maxPrice = Number(els.priceRange.value); updatePriceLabel(); renderBooks();
    });

    // Estoque chips (usa delega√ß√£o via container da sidebar)
    document.querySelectorAll('.chip[data-stock]').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.chip[data-stock]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.stock = btn.dataset.stock; render();
      });
    });

    els.sortSelect.addEventListener('change', (e) => { state.sort = e.target.value; renderBooks(); });

    els.clearFilters.addEventListener('click', () => {
      state.query = '';
      state.category = 'Todas';
      state.maxPrice = 300;
      state.stock = 'all';
      state.sort = 'relevance';
      els.searchInput.value = '';
      els.priceRange.value = 300; updatePriceLabel();
      renderCategoryChips();
      document.querySelectorAll('.chip[data-stock]').forEach((b,i)=> b.classList.toggle('active', i===0));
      render();
    });

    // ==============================================================
    // CICLO DE RENDERIZA√á√ÉO
    // ==============================================================

    function render() {
      renderCategoryChips();
      updatePriceLabel();
      renderBooks();
      renderCart();
      updateBadges();
    }

    // Inicializa a interface
    render();
  </script>
</body>
</html>